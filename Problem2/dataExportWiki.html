<!DOCTYPE html>
<html>
<head>
    <title></title>

    <script src="../libs/jquery-1.10.1.js"></script>
    <script src="../libs/jquery.xdomainajax.js"></script>
    <script src="../libs/d3.v3.min.js"></script>
    <script src="../libs/FileSaver.js"></script>
</head>
<body>

<script>
    var convertToInt;
	var fileinput;

    var convertToInt = function(d) {
	  return parseInt(d.replace(/,/g, ""), 10);
    };

    $.ajax({
        url: "http://en.wikipedia.org/wiki/World_population_estimates",
        type: 'GET',
        cache: false,
        success: function(data) {
            var root, allData, body, table;
            root = $("<div></div>")
            root.html(data.responseText)

            var content = root.find("#content"); // find all the nodes that have ID "content"
            //var h2s = content.find(".mw-headline"); // search in all "content" nodes for nodes of class ".mw-headline"
			var h2s = content.find(".wikitable tbody tr");
				//delete h2s[0];
				//console.log(h2s);
			
			
		var h3s;
		var data;
		var clean_data;
		var int_data;

            $.each(h2s, function(index, value) {
				// I think this is where I need to add another find statement
				//console.log($(value).text());
		        	//var data = $(value).text();//trim().replace(/\s/g, ' ')//.split(";"); // print text
				//console.log(data);

				if(index === 0)
					return;

				var $value = $(value);
				
				//console.log($(value).text());
				
				var tds = $value.find("td");

				//tds.first().text();

				$.each(tds, function(index, td){
	
					if(index === 0)
					return;

					if(index > 5)
					return;					

					var $td = $(td);
					console.log($td.text());					
					//var intdata = convertToInt(data);
					//data = h3s.text();
				
				});

				var data = [];
				data.push("");
				//clean_data = data.trim();
				//int_data = convertToInt(clean_data);
				
				// for each column in value convert text to int, if has length (!isNaN) then push it onto an array I make
				// array.join(",")
				// arrayOfLines.push(line)
				
				//var arr = data.split(",");

				//var trunc_data = data.slice(0,10);

				
				//. trim
				/*for (var i = 0; i< 5; i++){
					console.log(fileinput[i]);
				}*/
            });
			console.log(int_data);
			
			/*
			wordsArray = new Array(); 
			wordsArray[0] = "";
			["Year", "United States Census Bureau", "Population Reference Bureau", "United Nations Department of Economic and Social Affairs", 				"Maddison", "Tanton", "McEvedy", "Clark"].forEach(function(d){wordsArray[0]+=d+", ";});
			*/

			//This code is not getting called until after the ajax request runs

			console.log(trunc_data);
			saveToFile(["hello"],"test.txt")
        },
        error: function() {
            return console.log("error");
        }
    });


    /* takes an array of strings
       and writes them line by line into a file given by filename
     */
    var saveToFile = function(arrayOfLines, fileName) {
       /* adds linebreaks at the end*/
       var blob, blobText;
       blobText = arrayOfLines.map(function(d) {
         if (d.endsWith("\n")) {
           return d;
         } else {
           return d + "\n";
         }
       });
       blob = new Blob(blobText, {
         type: "text/plain;charset=utf-8"
       });
       return saveAs(blob, fileName);
     };

     String.prototype.endsWith = function(suffix) {
       return this.indexOf(suffix, this.length - suffix.length) !== -1;
     };
	



</script>


</body>
</html>
