<!DOCTYPE html>
<html>
<head>
    <title></title>

    <script src="../libs/jquery-1.10.1.js"></script>
    <script src="../libs/jquery.xdomainajax.js"></script>
    <script src="../libs/d3.v3.min.js"></script>
    <script src="../libs/FileSaver.js"></script>
</head>
<body>

<script>

    var convertToInt = function(d) {
		return parseInt(d.replace(/,/g, ""), 10);
    };

    $.ajax({
        url: "http://en.wikipedia.org/wiki/World_population_estimates",
        type: 'GET',
        cache: false,
        success: function(data) {
            var root, allData, body, table;
			var clean_td, int_td;
			var line = "";
			var line1 = "";
			var line2 = "";
			var line3 = "";
			var line4 = "";
			var year = "";

            root = $("<div></div>")
            root.html(data.responseText)

            var content = root.find("#content"); // find all the nodes that have ID "content"
            //var h2s = content.find(".mw-headline"); // search in all "content" nodes for nodes of class ".mw-headline"
			var trs = content.find(".wikitable tbody tr");

            $.each(trs, function(index, value) {

				if(index < 11)
					return;

				var $value = $(value);
				var tds = $value.find("td");

				$.each(tds, function(index, td){
					if(index === 0)
						return;

					if(index > 5)
						return;		
							
					var $td = $(td);
					clean_td = $td.text().trim();
					int_td = convertToInt(clean_td);
					if (isNaN(int_td)) int_td = " ";
					//console.log(int_td)

					if(index === 1){
						line += int_td;
						line += ",";
					}

					if(index === 2){
						line1 += int_td;
						line1 += ",";
					}

					if(index === 3){
						line2 += int_td;
						line2 += ",";
					}

					if(index === 4){
						line3 += int_td;
						line3 += ",";
					}

					if(index === 5){
						line4 += int_td;
						line4 += ",";
					}
					
					// I want to put every element in line where %5 = 1 in index 0 of array					
		
				});

            });

			/*
			wordsArray = new Array(); 
			wordsArray[0] = "";
			["Year", "United States Census Bureau", "Population Reference Bureau", "United Nations Department of Economic and Social Affairs", 				"Maddison", "Tanton", "McEvedy", "Clark"].forEach(function(d){wordsArray[0]+=d+", ";});
			*/

			
			//console.log(typeof(total_line));

			var data = [];
			//data[0] = "";
			//data[0] = line.concat(line1);
			data[0] = line;
			data[1] = line1;
			data[2] = line2;
			data[3] = line3;
			data[4] = line4;
			
			var str = line.concat(line1).concat(line2).concat(line3).concat(line4);

			var arr = str.split(',');
			//console.log(arr);

			// data[6] has all the information I want, I now just have to go from the 
			// figure out how to get every 5th element			

			var size = Math.floor(arr.length / 5 + 1);
			//console.log(size);

			var data2 = []; //switch the horizontal and vertical orientation of the data				
			
			//for (var i = 0; i < size ; i+=5){
				//data2.push(data[i]);
			//	data2[0] += arr[i];
			//}

			//
			// I have the data set up so that I have data[0] = column and I need data[0] = row. how to switch?
			// each row is the same as s column[1-5], column[5-10], column[10-15]. I need if column is 
			// if (column % 5
	

			//
			
			console.log(data);				
	
			//console.log(data2);

			//console.log(data);
			// need to pass in the data array and not the data string
			saveToFile(data,"test.txt")
        },
        error: function() {
            return console.log("error");
        }
    });


    /* takes an array of strings
       and writes them line by line into a file given by filename
     */
    var saveToFile = function(arrayOfLines, fileName) {
       /* adds linebreaks at the end*/
       var blob, blobText;
       blobText = arrayOfLines.map(function(d) {
         if (d.endsWith("\n")) {
           return d;
         } else {
           return d + "\n";
         }
       });
       blob = new Blob(blobText, {
         type: "text/plain;charset=utf-8"
       });
       return saveAs(blob, fileName);
     };

     String.prototype.endsWith = function(suffix) {
       return this.indexOf(suffix, this.length - suffix.length) !== -1;
     };




</script>


</body>
</html>
